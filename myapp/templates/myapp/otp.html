{% extends 'myapp/base1.html'%}
{% load static %}
{% block content %}

<section class="section-hero overlay inner-page bg-image" style="background-image: url('{% static 'images/hero_1.jpg' %}');" id="home-section">
<div class="container">
<div class="row align-items-center justify-content-center">
<div class="col-md-8 text-center">
<h1 class="text-white font-weight-bold">Verify Your Account</h1>
<div class="custom-breadcrumbs">
<a href="{% url 'home' %}">Home</a> <span class="mx-2 slash">/</span>
<span class="text-white"><strong>OTP Verification</strong></span>
</div>
</div>
</div>
</div>
</section>

<section class="site-section">
<div class="container">
<div class="row justify-content-center">
<div class="col-lg-5">
<div class="p-5 bg-white rounded shadow-lg">
<h2 class="h4 text-black mb-4 text-center">OTP Verification Page</h2>

                <!-- Display success or error message from views.py -->
                {% if msg %}
                    <div class="alert alert-{% if success %}success{% else %}danger{% endif %}" role="alert">
                        {{ msg }}
                    </div>
                {% endif %}
                
                <!-- Form submits to the verify_otp view -->
                <form action="{% url 'verify_otp' %}" method="POST">
                    {% csrf_token %}
                    
                    <!-- NEW: Visible Email Input Field -->
                    <div class="row form-group mb-4">
                        <div class="col-md-12">
                            <label class="text-black" for="email_field">Your Email *</label>
                            <!-- Pre-fill the email if it was passed via the query parameter -->
                            <input type="email" id="email_field" class="form-control" placeholder="Email" name="email" value="{{ email }}" readonly required=''>
                        </div>
                    </div>

                    <!-- OTP Input Field -->
                    <div class="row form-group">
                        <div class="col-md-12 mb-3">
                            <label class="text-black" for="otp_field">Your OTP *</label>
                            <input type="text" id="otp_field" class="form-control" placeholder="Enter your otp" name="otp" required minlength="5" maxlength="5">
                        </div>
                    </div>

                    <!-- Verify Button -->
                    <div class="row form-group mt-4">
                        <div class="col-md-12">
                            <button type="submit" class="btn btn-primary btn-md text-white btn-block" style="background-color: #007bff; border-color: #007bff;">Verify</button>
                        </div>
                    </div>
                </form>
                
                <div class="row form-group mt-3">
                    <div class="col-md-12 text-center">
                        <!-- Link to resend OTP using the JavaScript value of the email field -->
                        <p>Didn't receive code? <a href="#" id="resend-link" class="text-primary">Resend OTP</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const emailField = document.getElementById('email_field');
    const resendLink = document.getElementById('resend-link');

    function updateResendLink() {
        const email = emailField.value;
        if (email) {
            resendLink.href = "{% url 'resend_otp' %}?email=" + encodeURIComponent(email);
        } else {
            resendLink.href = "{% url 'otp_page' %}";
        }
    }

    updateResendLink();
    emailField.addEventListener('input', updateResendLink);
});
</script>


{% endblock %}